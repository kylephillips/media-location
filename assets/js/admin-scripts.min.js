(MediaLocationAdmin=MediaLocationAdmin||{}).MapForm=function(){var n=this,l=jQuery;return n.post=null,n.place=null,n.map=null,n.mapMarker=null,n.selectors={map:"data-media-location-map",placeInput:"data-media-location-place-input",saveButton:"data-media-location-save"},n.bindEvents=function(){wp.media.frame.on("all",function(e){console.log(e)}),void 0!==window.wp.media&&window.wp.media.frame.on("edit:attachment",function(){n.getAttachmentData(),n.enableAutocomplete()}),l(document).on("click","["+n.selectors.saveButton+"]",function(e){e.preventDefault(),n.updateLocation()}),l(document).on("media-location-post-details-retrieved",function(){n.updateMap()}),l(document).on("media-location-place-changed",function(){n.updateMap()}),l(document).on("search","["+n.selectors.placeInput+"]",function(){""===l(this).val()&&(n.post.latitude=null,n.place=null,n.updateMap())})},n.enableAutocomplete=function(){var e=l("["+n.selectors.placeInput+"]"),a=new google.maps.places.Autocomplete(e[0]);google.maps.event.addListener(a,"place_changed",function(){n.place=a.getPlace(),l(document).trigger("media-location-place-changed")})},n.getAttachmentData=function(){var e=l("["+n.selectors.map+"]").attr(n.selectors.map);l.ajax({url:media_location.rest_url+"/attachment",type:"GET",data:{id:e},success:function(e){n.post=e,l(document).trigger("media-location-post-details-retrieved",[n.post])},error:function(e){console.log(e)}})},n.updateMap=function(){var e=l("["+n.selectors.map+"]"),a=(new google.maps.InfoWindow,n.post.latitude?parseFloat(n.post.latitude):35.3256357),t=n.post.longitude?parseFloat(n.post.longitude):-42.6099961,o=n.post.latitude?14:1;n.place&&(a=n.place.geometry.location.lat(),t=n.place.geometry.location.lng(),o=14);t=new google.maps.LatLng(a,t);n.map=new google.maps.Map(e[0],{mapTypeId:"roadmap",mapTypeControl:!1,zoom:o,panControl:!1,disableDefaultUI:!1,streetViewControl:!1,zoomControl:!1,center:t}),(n.post.latitude&&n.post.longitude||n.place)&&(n.mapMarker&&(n.mapMarker.setMap(null),n.mapMarker=null),n.mapMarker=new google.maps.Marker({position:t,map:n.map,title:"location"}))},n.updateLocation=function(){n.toggleLoading(!0);var e={action:"media_location_update"};e.nonce=media_location.nonce,e.id=l("["+n.selectors.map+"]").attr(n.selectors.map),e.place_id=n.place?n.place.place_id:null,e.place_name=n.place?n.place.name:null,e.latitude=n.place?n.place.geometry.location.lat():null,e.longitude=n.place?n.place.geometry.location.lng():null,e.formatted_address=n.place?n.place.formatted_address:null,l.ajax({url:ajaxurl,type:"POST",data:e,success:function(e){n.toggleLoading(!1)},error:function(e){console.log(e),n.toggleLoading(!1)}})},n.toggleLoading=function(e){var a=l("["+n.selectors.saveButton+"]");e?l(a).attr("disabled",!0):l(a).removeAttr("disabled")},n.bindEvents()};var MediaLocationAdmin=MediaLocationAdmin||{};jQuery(document).ready(function(){new MediaLocationAdmin.Factory}),MediaLocationAdmin.Factory=function(){return self.build=function(){new MediaLocationAdmin.MapForm},self.build()};